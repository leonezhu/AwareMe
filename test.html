<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AwareMe æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #007AFF;
        }
        .problem {
            background: #fff3cd;
            border-left-color: #ffc107;
        }
        .solution {
            background: #d1edff;
            border-left-color: #0084ff;
        }
        .fixed {
            background: #d4edda;
            border-left-color: #28a745;
        }
        code {
            background: #f1f3f4;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            overflow-x: auto;
        }
        .highlight {
            background: #fff3cd;
            padding: 2px 4px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ”§ AwareMe æ’ä»¶ä¿®å¤æŠ¥å‘Š</h1>
        <p>è§£å†³ weibo.com è®¿é—®æƒé™æ£€æŸ¥é—®é¢˜</p>
    </div>

    <div class="section problem">
        <h2>ğŸ› é—®é¢˜æè¿°</h2>
        <p>ç”¨æˆ·æŠ¥å‘Šçš„é—®é¢˜ï¼š</p>
        <ul>
            <li>æ¯å¤©ç¬¬ä¸€æ¬¡æ‰“å¼€è¢«æ‹¦æˆªçš„ç½‘ç«™ <code>weibo.com</code> æ—¶ï¼Œä¼šä¸€ç›´æ˜¾ç¤º"æ­£åœ¨æ£€æŸ¥è®¿é—®æƒé™"çš„è’™ç‰ˆ</li>
            <li>æ’ä»¶åœ¨ <code>background.js</code> ä¸­æŠ¥é”™ï¼š<code>Uncaught (in promise) Error: Could not establish connection. Receiving end does not exist.</code></li>
        </ul>
    </div>

    <div class="section solution">
        <h2>ğŸ” é—®é¢˜åˆ†æ</h2>
        <p>ç»è¿‡ä»£ç åˆ†æï¼Œå‘ç°é—®é¢˜çš„æ ¹æœ¬åŸå› ï¼š</p>
        <ol>
            <li><strong>æ¶ˆæ¯å‘é€æ—¶æœºé—®é¢˜</strong>ï¼šbackground script å‘ content script å‘é€æ¶ˆæ¯æ—¶ï¼Œcontent script å¯èƒ½è¿˜æœªå®Œå…¨åŠ è½½</li>
            <li><strong>é”™è¯¯å¤„ç†ä¸å½“</strong>ï¼šæ²¡æœ‰æ­£ç¡®å¤„ç† Chrome æ‰©å±•çš„è¿æ¥é”™è¯¯</li>
            <li><strong>é‡è¯•æœºåˆ¶è¿‡åº¦</strong>ï¼šcontent script çš„é‡è¯•æ¬¡æ•°è¿‡å¤šï¼Œå»¶è¿Ÿè¿‡é•¿</li>
            <li><strong>ç¼ºå°‘è¶…æ—¶ä¿æŠ¤</strong>ï¼šæ²¡æœ‰è¶…æ—¶æœºåˆ¶é˜²æ­¢é®ç½©ä¸€ç›´æ˜¾ç¤º</li>
        </ol>
    </div>

    <div class="section fixed">
        <h2>âœ… ä¿®å¤æ–¹æ¡ˆ</h2>
        <h3>1. æ·»åŠ å®‰å…¨çš„æ¶ˆæ¯å‘é€æœºåˆ¶</h3>
        <p>åœ¨ <code>background.js</code> ä¸­æ·»åŠ äº† <code>sendMessageToTab</code> æ–¹æ³•ï¼š</p>
        <div class="code-block">
            <code>
            sendMessageToTab(tabId, message) {<br>
            &nbsp;&nbsp;chrome.tabs.sendMessage(tabId, message, (response) => {<br>
            &nbsp;&nbsp;&nbsp;&nbsp;if (chrome.runtime.lastError) {<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// å¿½ç•¥è¿æ¥é”™è¯¯ï¼Œé¿å…æŠ›å‡ºå¼‚å¸¸<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(`å‘é€æ¶ˆæ¯å¤±è´¥: ${chrome.runtime.lastError.message}`);<br>
            &nbsp;&nbsp;&nbsp;&nbsp;}<br>
            &nbsp;&nbsp;});<br>
            }
            </code>
        </div>

        <h3>2. ä¼˜åŒ–é‡è¯•æœºåˆ¶</h3>
        <p>æ”¹è¿› <code>content.js</code> ä¸­çš„é‡è¯•é€»è¾‘ï¼š</p>
        <ul>
            <li>å‡å°‘æœ€å¤§é‡è¯•æ¬¡æ•°ï¼šä» 5 æ¬¡é™è‡³ 3 æ¬¡</li>
            <li>ç¼©çŸ­é‡è¯•é—´éš”ï¼š500ms, 1s, 2sï¼ˆåŸæ¥æ˜¯ 1s, 2s, 4s, 8s, 16sï¼‰</li>
            <li>é’ˆå¯¹æ€§å¤„ç†"Receiving end does not exist"é”™è¯¯</li>
        </ul>

        <h3>3. æ·»åŠ è¶…æ—¶ä¿æŠ¤æœºåˆ¶</h3>
        <p>åœ¨ <code>content.js</code> ä¸­æ·»åŠ  10 ç§’è¶…æ—¶ï¼š</p>
        <div class="code-block">
            <code>
            setupOverlayTimeout() {<br>
            &nbsp;&nbsp;this.overlayTimeout = setTimeout(() => {<br>
            &nbsp;&nbsp;&nbsp;&nbsp;if (this.loadingOverlay && !this.isPageAllowed) {<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.warn('æ£€æŸ¥è¶…æ—¶ï¼Œè‡ªåŠ¨ç§»é™¤é®ç½©');<br>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.removeLoadingOverlay();<br>
            &nbsp;&nbsp;&nbsp;&nbsp;}<br>
            &nbsp;&nbsp;}, 10000);<br>
            }
            </code>
        </div>

        <h3>4. æ”¹å–„æ¶ˆæ¯å¤„ç†</h3>
        <p>åœ¨ background script çš„æ¶ˆæ¯ç›‘å¬å™¨ä¸­è¿”å› <code>true</code>ï¼Œè¡¨ç¤ºå¼‚æ­¥å¤„ç†å“åº”ã€‚</p>
    </div>

    <div class="section fixed">
        <h2>ğŸ¯ ä¿®å¤æ•ˆæœ</h2>
        <p>ä¿®å¤åçš„æ”¹è¿›ï¼š</p>
        <ul>
            <li>âœ… <strong>æ¶ˆé™¤è¿æ¥é”™è¯¯</strong>ï¼šæ­£ç¡®å¤„ç† Chrome æ‰©å±•æ¶ˆæ¯ä¼ é€’çš„å¼‚æ­¥ç‰¹æ€§</li>
            <li>âœ… <strong>å‡å°‘ç­‰å¾…æ—¶é—´</strong>ï¼šä¼˜åŒ–é‡è¯•æœºåˆ¶ï¼Œæ›´å¿«å“åº”</li>
            <li>âœ… <strong>é˜²æ­¢å¡æ­»</strong>ï¼šæ·»åŠ è¶…æ—¶ä¿æŠ¤ï¼Œç¡®ä¿ç”¨æˆ·ä¸ä¼šè¢«æ°¸ä¹…é˜»å¡</li>
            <li>âœ… <strong>æå‡ç”¨æˆ·ä½“éªŒ</strong>ï¼šå‡å°‘ä¸å¿…è¦çš„å»¶è¿Ÿå’Œé”™è¯¯æç¤º</li>
        </ul>
    </div>

    <div class="section">
        <h2>ğŸ§ª æµ‹è¯•å»ºè®®</h2>
        <p>å»ºè®®è¿›è¡Œä»¥ä¸‹æµ‹è¯•ï¼š</p>
        <ol>
            <li>é‡æ–°åŠ è½½æ’ä»¶ï¼ˆåœ¨ Chrome æ‰©å±•ç®¡ç†é¡µé¢ï¼‰</li>
            <li>è®¿é—®é…ç½®ä¸­çš„å—é™ç½‘ç«™ï¼ˆå¦‚ weibo.comï¼‰</li>
            <li>è§‚å¯Ÿæ§åˆ¶å°æ˜¯å¦è¿˜æœ‰è¿æ¥é”™è¯¯</li>
            <li>éªŒè¯é®ç½©æ˜¯å¦èƒ½æ­£å¸¸æ˜¾ç¤ºå’Œæ¶ˆå¤±</li>
            <li>æµ‹è¯•åœ¨ç½‘ç»œè¾ƒæ…¢æƒ…å†µä¸‹çš„è¡¨ç°</li>
        </ol>
    </div>

    <div class="section">
        <h2>ğŸ“ æŠ€æœ¯è¯´æ˜</h2>
        <p>æ­¤æ¬¡ä¿®å¤ä¸»è¦è§£å†³äº† Chrome æ‰©å±•å¼€å‘ä¸­å¸¸è§çš„æ¶ˆæ¯ä¼ é€’é—®é¢˜ï¼š</p>
        <ul>
            <li><span class="highlight">Service Worker ç”Ÿå‘½å‘¨æœŸ</span>ï¼šManifest V3 ä¸­çš„ background script æ˜¯ service workerï¼Œå¯èƒ½ä¼šè¢«æµè§ˆå™¨æš‚åœå’Œæ¢å¤</li>
            <li><span class="highlight">Content Script æ³¨å…¥æ—¶æœº</span>ï¼šè™½ç„¶è®¾ç½®äº† <code>document_start</code>ï¼Œä½†ä»å¯èƒ½å­˜åœ¨æ—¶åºé—®é¢˜</li>
            <li><span class="highlight">å¼‚æ­¥æ¶ˆæ¯å¤„ç†</span>ï¼šéœ€è¦æ­£ç¡®å¤„ç† Chrome API çš„å¼‚æ­¥ç‰¹æ€§</li>
        </ul>
    </div>

    <script>
        // ç®€å•çš„é¡µé¢äº¤äº’
        console.log('AwareMe æµ‹è¯•é¡µé¢å·²åŠ è½½');
        
        // æ£€æŸ¥æ’ä»¶æ˜¯å¦æ­£å¸¸å·¥ä½œ
        if (typeof chrome !== 'undefined' && chrome.runtime) {
            console.log('Chrome æ‰©å±• API å¯ç”¨');
        } else {
            console.log('Chrome æ‰©å±• API ä¸å¯ç”¨');
        }
    </script>
</body>
</html>